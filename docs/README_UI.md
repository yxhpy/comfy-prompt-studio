# AI 图片生成器 - 移动端 UI

## 功能特性

### ✨ 核心功能
- **移动端优先设计**: 完美适配手机屏幕，支持触摸操作
- **智能队列管理**: 自动管理图片生成队列
- **实时进度显示**: WebSocket 实时更新生成进度
- **自动加载更多**: 滚动到 1/2 位置自动触发新一批生成
- **停止/继续控制**: 随时停止或继续生成任务
- **持久化需求**: 不提交新需求则持续使用旧需求生成

### 📱 产品特性
1. **便捷输入**: 大文本框，易于手机输入
2. **数量自定义**: 默认 10 张，可自由调整
3. **瀑布流展示**: 响应式网格布局，自适应屏幕
4. **平滑动画**: 图片淡入效果，提升体验
5. **实时反馈**: 进度条实时显示当前生成状态

## 安装依赖

```bash
pip install -r requirements.txt
```

## 启动服务

```bash
python -m src.cli.run
```

服务将在 `http://0.0.0.0:5000` 启动

## 使用说明

### 1. 访问界面
- 在手机浏览器打开: `http://你的服务器IP:5000`
- 在电脑浏览器打开: `http://localhost:5000`

### 2. 开始生成
1. 在文本框输入图片描述
2. 设置生成数量（默认 10）
3. 点击"开始生成"按钮

### 3. 查看进度
- 顶部进度条显示当前生成进度
- 图片生成后自动显示在画廊中

### 4. 自动加载
- 向下滚动到已生成图片的一半时
- 系统自动添加新的生成任务到队列
- 无需手动操作，持续使用当前需求

### 5. 停止生成
- 点击"停止"按钮立即停止生成
- 已生成的图片会保留

## 技术架构

### 后端 (Flask + SocketIO)
- **src/app/__init__.py**: Flask 应用工厂
- **src/cli/run.py**: 应用启动入口
- **端点**:
  - `POST /api/start`: 开始生成
  - `POST /api/stop`: 停止生成
  - `GET /api/status`: 获取状态
  - `POST /api/add_more`: 添加更多任务

### 前端 (HTML + JavaScript)
- **响应式设计**: 移动端优先，自适应布局
- **WebSocket**: 实时双向通信
- **Intersection Observer**: 滚动监听，自动触发
- **渐进式加载**: 图片生成后立即显示

### 工作流程
1. 用户提交需求 → 后端生成提示词
2. 调用 ComfyUI API 生成图片
3. WebSocket 推送新图片到前端
4. 前端实时更新画廊和进度
5. 滚动到 1/2 时自动添加新任务

## 目录结构

```
comfyui/
├── src/
│   ├── app/              # Flask 应用
│   ├── cli/
│   │   └── run.py        # 启动入口
│   └── core/
│       ├── comfyui/      # ComfyUI 集成
│       └── prompt/       # 提示词生成
├── config/
│   └── workflows/        # ComfyUI 工作流
├── templates/
│   └── index.html        # 前端界面
├── static/
│   └── generated/        # 生成的图片
└── data/
    └── generated/        # 新的图片存储位置
```

## 注意事项

1. 确保 ComfyUI 服务运行在 `127.0.0.1:8188`
2. 确保 Ollama 服务运行在 `localhost:11434`
3. 首次使用需要安装所需模型和 LoRA
4. 生成的图片保存在 `static/generated/` 目录

## 移动端优化

- ✅ 视口适配，禁用缩放
- ✅ 大按钮，易于点击
- ✅ 触摸反馈动画
- ✅ 流畅滚动
- ✅ 最小网络请求
- ✅ WebSocket 实时更新
